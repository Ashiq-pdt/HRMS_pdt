<!-- templates/admin/index.html -->

{% extends "layout/base.html" %}
{% block head %}
{{ super() }}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">

<style>
    .multi-wrapper, .multi-wrapper .non-selected-wrapper,.multi-wrapper .selected-wrapper{
        height: 50vh;
    }
</style>
{% endblock %}
{% block content %}

<!--Page header-->
<div class="page-header d-xl-flex d-block">
    <div class="page-leftheader">
        <div class="page-title">Duplicates</div>
    </div>
    <div class="page-rightheader ms-md-auto">
        <div class="d-flex align-items-end flex-wrap my-auto end-content breadcrumb-end">
            <div class="btn-list">
                <button class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="top" title="E-mail"> <i
                        class="feather feather-mail"></i> </button>
                <button class="btn btn-light" data-bs-placement="top" data-bs-toggle="tooltip" title="Contact"> <i
                        class="feather feather-phone-call"></i> </button>
                <button class="btn btn-primary" data-bs-placement="top" data-bs-toggle="tooltip" title="Info"> <i
                        class="feather feather-info"></i> </button>
            </div>
        </div>
    </div>
</div>
<!--End Page header-->

<!-- Row -->
<div class="container-fluid mt-5">
    <h1>Duplicate Adjustments</h1>
    {% if duplicates %}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Created Date</th>
                    <th>Modified Date</th>
                   
                    <th>Count</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                {% for duplicate in duplicates %}
                    <tr>
                        <td>{{ duplicate._id.created_date }}</td>
                        <td>{{ duplicate._id.modified_date }}</td>
                      
                        <td>{{ duplicate.count }}</td>
                        <td>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>_id</th>
                                        <th>Employee Name</th>
                                        <th>Adjustment Days</th>
                                        <th>Before Adjustment</th>
                                        <th>After Adjustment</th>
                                        <th>Modified On</th>
                                        <th>Leave From</th>
                                        <th>Approved On</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for doc in duplicate.docs %}
                                        <tr>
                                            <td>{{doc._id}}</td>
                                            <td>{{ doc.employee_name }}</td>
                                            <td>{{ doc.adjustment_days }}</td>
                                            <td>{{ doc.before_adjustment }}</td>
                                            <td>{{ doc.after_adjustment }}</td>
                                            <td>{{ doc.modified_on }}</td>
                                            <td>{{ doc.leave_from }}</td>
                                            <td>{{ doc.approved_on }}</td>
                                            <td>
                                                <button class="btn btn-danger btn-sm delete-btn" data-doc-id="{{ doc._id }}">
                                                    Delete
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No duplicate adjustments found.</p>
    {% endif %}
</div>
<!-- End Row -->

{% endblock %}

{% block script %}
{{ super() }}
<!-- INTERNAL Fullcalendar js-->
<script src="{{ url_for('static', filename='assets/plugins/bootstrap-datepicker/bootstrap-datepicker.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.all.min.js"></script>

<!-- Select2 js -->
<script>
    fpm = $('#filter-datepicker-month').bootstrapdatepicker({
        format: "MM yyyy",
        startdate: '+0m',
        startView: "months",
        minViewMode: "months",
        orientation: 'bottom',
        autoclose: true
    })
    // To get the month and year in route
    fpm.on('changeDate', function (e) {
        $('.action-btns').attr("data-selected_month", e.dates)
        $('#selected_month').val(moment(new Date(e.dates)).format('YYYY-MM-DD'))
    });
    
</script>
<script>
    $(document).on('click', '.delete-btn', function () {
     
        var button = $(this);
        var docId = button.data('doc-id'); 
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to recover this adjustment!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) 
            {
                $.ajax({
                    url: '/deleteadjustment123/' + docId,  // Make sure this is the correct URL
                    type: 'get',
                    success: function (response) {
                        Swal.fire(
                            'Deleted!',
                            response.message,
                            'success'
                        );
                        button.closest('tr').remove(); // Remove the deleted row
                    },
                    error: function (xhr) {
                        var errorMessage = xhr.responseJSON ? xhr.responseJSON.error : 'An unknown error occurred';
                        Swal.fire(
                            'Error!',
                            errorMessage,
                            'error'
                        );
                    }
                });


           
            }
        });
    });
</script>
{% endblock %}